SUBDIRLIST(TPL_LIB_DIRS "${CMAKE_CURRENT_LIST_DIR}")
list(FILTER TPL_LIB_DIRS EXCLUDE REGEX "xtl" )

set(THIRD_PARTY_SRCS, "")
set(THIRD_PARTY_ASSEMBLY_FILES, "")
set(THIRD_PARTY_INCL_DIRS, "")

FOREACH(TPLIB_DIR ${TPL_LIB_DIRS})
  ADD_SUBDIRECTORY(${TPLIB_DIR})
  string(APPEND THIRD_PARTY_INCL_DIRS "${CMAKE_CURRENT_LIST_DIR}/${TPLIB_DIR}/include")
  
  FILE(GLOB_RECURSE TMP_THIRD_PARTY_SRCS
    "${CMAKE_CURRENT_LIST_DIR}/${TPLIB_DIR}/*.c"
    "${CMAKE_CURRENT_LIST_DIR}/${TPLIB_DIR}/*.h"
    "${CMAKE_CURRENT_LIST_DIR}/${TPLIB_DIR}/*.cpp"
    "${CMAKE_CURRENT_LIST_DIR}/${TPLIB_DIR}/*.hpp"
    "${CMAKE_CURRENT_LIST_DIR}/${TPLIB_DIR}/*.s"
    "${CMAKE_CURRENT_LIST_DIR}/${TPLIB_DIR}/*.S"
    )
  string(APPEND THIRD_PARTY_SRCS "${TMP_THIRD_PARTY_SRCS}")

  FILE(GLOB_RECURSE TMP_THIRD_PARTY_ASSEMBLY_FILES
    "${CMAKE_CURRENT_LIST_DIR}/${TPLIB_DIR}/*.s"
    "${CMAKE_CURRENT_LIST_DIR}/${TPLIB_DIR}/*.s"
    )
  string(APPEND THIRD_PARTY_ASSEMBLY_FILES "${TMP_THIRD_PARTY_ASSEMBLY_FILES}")
ENDFOREACH()

include_directories(${SDK_ROOT}/lib/drivers/include ${SDK_ROOT}/lib/bsp/include ${SDK_ROOT}/lib/utils/include THIRD_PARTY_INCL_DIRS)
header_directories(THIRD_PARTY_INCL_DIRS)

SET_PROPERTY(SOURCE ${THIRD_PARTY_ASSEMBLY_FILES} PROPERTY LANGUAGE C)
SET_SOURCE_FILES_PROPERTIES(${THIRD_PARTY_ASSEMBLY_FILES} PROPERTIES COMPILE_FLAGS "-x assembler-with-cpp -D __riscv64")

list(LENGTH THIRD_PARTY_SRCS THIRD_PARTY_SRCS_LENGTH)
if(${THIRD_PARTY_SRCS_LENGTH} GREATER 0)
  ADD_LIBRARY(tplibs ${THIRD_PARTY_SRCS})
  TARGET_LINK_LIBRARIES(tplibs PUBLIC ${TPL_LIB_DIRS})
  SET_TARGET_PROPERTIES(tplibs PROPERTIES LINKER_LANGUAGE C)
endif()
